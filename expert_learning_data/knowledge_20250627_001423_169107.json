{
  "source": "github_patterns",
  "url": "https://github.com/thangchung/clean-architecture-dotnet",
  "type": "project_documentation",
  "content": "# üîÜ clean-architecture-dotnet\n\n\"Everything should be made as simple as possible, but not simpler.\" - Albert Einstein\n\n\"M·ªçi th·ª© ƒë·ªÅu n√™n ƒë∆°n gi·∫£n, c√†ng ƒë∆°n gi·∫£n c√†ng t·ªët, nh∆∞ng kh√¥ng n√™n ƒë∆°n gi·∫£n h∆°n b·∫£n ch·∫•t c·ªßa n√≥.\" - Vietnamese translated\n\nWe know that, and that's a reason we publish these libraries and samples. These are distillations with all best practices, tips, and tricks, and whatever made us spend a lot of time struggling to solve.\n\nIn the end of our journey, we would like to give these simplified and effortless libraries and samples as a reward for you. Enjoy the Minimal Clean Architecture, Domain-driven Design Lite, CQRS Lite, and just enough Cloud-native patterns!\n\n[![Sparkline](https://stars.medv.io/thangchung/clean-architecture-dotnet.svg)](https://stars.medv.io/thangchung/clean-architecture-dotnet)\n\n> ### DISCLAIMER\n> \n> **IMPORTANT:** Because we are constantly evolving towards newly released technologies, .NET 6 is in the preview state so that it might change a lot in every release by the .NET team. So even we're trying to do the best for this OSS. But be careful if you use it for your project, and make sure that you do a stress test, benchmarking these libraries, and refactor them subsequently to adapt to your business carefully.\n> \n> **Feedback** with improvements and pull requests from the community will be highly appreciated. Thank you!\n\n# ‚≠ê Give a star\n\nIf you're using this repository for your learning, samples, workshop, or your project, please give a star. Thanks :+1:\n\n# üéá Business Usecases\n\n![](assets/usecase_diagram.png)\n\n# üéá High level context\n\n![](assets/context_diagram.png)\n\n# üéá ERD\n\n![](assets/class_diagram.png)\n\n# üéá Minimal DDD, CQRS, and Clean Architecture\n\n1. `Domain-driven Design` (a.k.a DDD) demonstrates it can help the business tidy and organized in many years. But it is hard to approach and use, we need to make it easier to use in real projects when we get started.\n\n2. `Command and Query Responsibility Segregation` (a.k.a CQRS) helps to separate components into command and query parts, but again it's really hard and might bloat when we get starting some of the project. We need something more lightweight, just like https://github.com/gautema/CQRSlite, but we might not need Event Sourcing in almost all projects.\n\n3. `Clean Architecture` helps the project structure easier to refactor and evolve in medium and big projects. Especially in the Microservice world, we always want to do and try with a lot of time in the project lifetime. The thing is boilerplate code in this kind of project to make components lose coupling.\n\n=> When we jump in and set up the project for the Microservice approach. We want to apply all the best practices from the community, and some kind of patterns and architecture above sometimes makes us feel power off when start implements the first line of code which actually solves the business requirements. So the solution is we need something minimal and enough to get starting, and then when our business gets grows by the time, then we go back to add more. That's what's the practical way to go!\n\n`clean-architecture-dotnet` is a collection of basic building blocks and project structure to help we get starting the project with less code boilerplate and effortless. We focus on the Microservice approach of how can we organize code, the project with the monorepo approach, and you can use it for modular monolith projects as well.\n\n![](assets/DomainDrivenHexagon.png)\nReference to https://github.com/Sairyss/domain-driven-hexagon\n\n# üíé Prerequisites\n\n- [.NET SDK](https://dotnet.microsoft.com/download/dotnet/6.0): 6.0.100-preview.5.21271.2\n- [nodejs](https://nodejs.org/en/download): v15.5.1\n- [tye](https://github.com/dotnet/tye): 0.8.0-alpha.21301.1+0fed0b38e730cd07caf0a90287090638c110b77d\n  - [Tan Hoang](https://github.com/cuno92) and [Mohammad AlQuraian](https://github.com/Quraian) have confused about `tye 0.8.0`, and asked to add the guidance so I put it here\n    - Follow the guidance at https://github.com/dotnet/tye/blob/647a608892/docs/getting_started.md#working-with-ci-builds\n    - More specifically, adding `dotnet tool install -g Microsoft.Tye --version \"0.8.0-*\" --add-source https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet5/nuget/v3/index.json` to your terminal\n- [dapr](https://dapr.io/): 1.2.0\n- Dev tools:\n  - [vscode tye](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-tye) extension\n  - [vscode REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client) extension\n  - [vscode Markmap](https://marketplace.visualstudio.com/items?itemName=gera2ld.markmap-vscode) extension\n\n# :hearts: Technical stacks\n- ‚úîÔ∏è **[`.NET Core 6`](https://dotnet.microsoft.com/download)** - .NET Framework and .NET Core, including ASP.NET and ASP.NET Core\n- ‚úîÔ∏è **[`MVC Versioning API`](https://github.com/microsoft/aspnet-api-versioning)** - Set of libraries which add service API versioning to ASP.NET Web API, OData with ASP.NET Web API, and ASP.NET Core\n- ‚úîÔ∏è **[`YARP`](https://github.com/microsoft/reverse-proxy)** - A toolkit for developing high-performance HTTP reverse proxy applications\n- ‚úîÔ∏è **[`MediatR`](https://github.com/jbogard/MediatR)** - Simple, unambitious mediator implementation in .NET\n- ‚úîÔ∏è **[`EF Core`](https://github.com/dotnet/efcore)** - Modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations\n- ‚úîÔ∏è **[`FluentValidation`](https://github.com/FluentValidation/FluentValidation)** - Popular .NET validation library for building strongly-typed validation rules\n- ‚úîÔ∏è **[`Swagger & Swagger UI`](https://github.com/domaindrivendev/Swashbuckle.AspNetCore)** - Swagger tools for documenting API's built on ASP.NET Core\n- ‚úîÔ∏è **[`serilog`](https://github.com/serilog/serilog)** - Simple .NET logging with fully-structured events\n- ‚úîÔ∏è **[`Dapr dotnet-sdk`](https://github.com/dapr/dotnet-sdk)** - Dapr SDK for .NET\n- ‚úîÔ∏è **[`RestEase`](https://github.com/canton7/RestEase)** - Easy-to-use typesafe REST API client library for .NET Standard 1.1 and .NET Framework 4.5 and higher, which is simple and customisable\n- ‚úîÔ∏è **[`Polly`](https://github.com/App-vNext/Polly)** - Polly is a .NET resilience and transient-fault-handling library that allows developers to express policies such as Retry, Circuit Breaker, Timeout, Bulkhead Isolation, and Fallback in a fluent and thread-safe manner\n- ‚úîÔ∏è **[`Scrutor`](https://github.com/khellang/Scrutor)** - Assembly scanning and decoration extensions for Microsoft.Extensions.DependencyInjection\n- ‚úîÔ∏è **[`opentelemetry-dotnet`](https://github.com/open-telemetry/opentelemetry-dotnet)** - The OpenTelemetry .NET Client\n- ‚úîÔ∏è **[`Blazor - WASM`](https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor)** - Client web apps with C#\n- ‚úîÔ∏è **[`BFF`](https://github.com/DuendeSoftware/BFF)** - Framework for ASP.NET Core to secure SPAs using the Backend-for-Frontend (BFF) pattern\n\n# üéá All packages dependencies\n\n![](assets/package_dependencies.png)\n\n## ‚úîÔ∏è Building blocks\n\n\n```bash\n+---N8T.Core\n|   |   N8T.Core.csproj\n|   |\n|   +---Domain\n|   |       Cqrs.cs\n|   |       Entities.cs\n|   |       Events.cs\n|   |       Exceptions.cs\n|   |\n|   +---Helpers\n|   |       DateTimeHelper.cs\n|   |       GuidHelper.cs\n|   |\n|   +---Repository\n|   |       IRepository.cs\n|   |\n|   \\---Specification\n|           And.cs\n|           Extensions.cs\n|           GridSpecificationBase.cs\n|           ISpecification.cs\n|           Negated.cs\n|           Or.cs\n|           PredicateBuilder.cs\n|           SpecificationBase.cs\n|\n+---N8T.Infrastructure\n|   |   AppOptions.cs\n|   |   Extensions.cs\n|   |   N8T.Infrastructure.csproj\n|   |\n|   +---Auth\n|   |       AuthBehavior.cs\n|   |       Extensions.cs\n|   |       IAuthRequest.cs\n|   |       ISecurityContextAccessor.cs\n|   |       SecurityContextAccessor.cs\n|   |\n|   +---Bus\n|   |   |   Extensions.cs\n|   |   |   IEventBus.cs\n|   |   |\n|   |   \\---Dapr\n|   |       |   DaprEventBusOptions.cs\n|   |       |\n|   |       \\---Internal\n|   |               DaprEventBus.cs\n|   |\n|   +---Controller\n|   |       BaseController.cs\n|   |\n|   +---Helpers\n|   |       ConfigurationHelper.cs\n|   |\n|   +---Logging\n|   |       Extensions.cs\n|   |       LoggingBehavior.cs\n|   |       TraceIdEnricher.cs\n|   |\n|   +---ServiceInvocation\n|   |   \\---Dapr\n|   |           Extensions.cs\n|   |\n|   +---Status\n|   |       Extensions.cs\n|   |       StatusModel.cs\n|   |\n|   +---Swagger\n|   |       ConfigureSwaggerOptions.cs\n|   |       Extentions.cs\n|   |       SwaggerDefaultValues.cs\n|   |\n|   +---TransactionalOutbox\n|   |   |   Extensions.cs\n|   |   |   OutboxEntity.cs\n|   |   |\n|   |   \\---Dapr\n|   |       |   DaprTransactionalOutboxOptions.cs\n|   |       |   ITransactionalOutboxProcessor.cs\n|   |       |\n|   |       \\---Internal\n|   |               LocalDispatchedHandler.cs\n|   |               TransactionalOutboxProcessor.cs\n|   |\n|   \\---Validator\n|           Extensions.cs\n|           RequestValidationBehavior.cs\n|           ValidationError.cs\n|           ValidationException.cs\n|           ValidationResultModel.cs\n|\n+---N8T.Infrastructure.EfCore\n|   |   AppDbContextBase.cs\n|   |   Consts.cs\n|   |   DbContextDesignFactoryBase.cs\n|   |   Extensions.cs\n|   |   IDbFacadeResolver.cs\n|   |   N8T.Infrastructure.EfCore.csproj\n|   |   Repository.cs\n|   |   TxBehavior.cs\n|   |\n|   \\---Internal\n|           DbContextMigratorHostedService.cs\n|\n\\---N8T.Infrastructure.OTel\n    |   Extensions.cs\n    |   N8T.Infrastructure.OTel.csproj\n    |\n    \\---MediatR\n            OTelMediatROptions.cs\n            OTelMediatRTracingBehavior.cs\n```\n\n## ‚úîÔ∏è Product service structure (microservice)\n\n\n```bash\n+---ProductService.Api\n|   |   .dockerignore\n|   |   appsettings.json\n|   |   Dockerfile\n|   |   ProductService.Api.csproj\n|   |   Program.cs\n|   |\n|   +---Properties\n|   |       launchSettings.json\n|   |\n|   \\---V1\n|           Anchor.cs\n|           IntegrationEventHandler.cs\n|           ProductController.cs\n|           TransactionalOutboxProcessor.cs\n|\n+---ProductService.AppCore\n|   |   Anchor.cs\n|   |   ProductService.AppCore.csproj\n|   |\n|   +---Core\n|   |   |   Product.cs\n|   |   |   ProductCode.cs\n|   |   |   Return.cs\n|   |   |   ReturnReason.cs\n|   |   |\n|   |   \\---Specs\n|   |           ProductByIdQuerySpec.cs\n|   |           ProductIsInStockSpec.cs\n|   |           ProductListQuerySpec.cs\n|   |           ProductReturnReasonSpec.cs\n|   |\n|   \\---UseCases\n|       +---Commands\n|       |       CreateProduct.cs\n|       |\n|       \\---Queries\n|               GetProductById.cs\n|               GetProducts.cs\n|\n\\---ProductService.Infrastructure\n    |   Anchor.cs\n    |   Extensions.cs\n    |   ProductService.Infrastructure.csproj\n    |   readme.txt\n    |\n    \\---Data\n        |   MainDbContext.cs\n        |   MainDbContextDesignFactory.cs\n        |   Repository.cs\n        |\n        +---Migrations\n        |       20210129103734_InitialProductionDb.cs\n        |       20210129103734_InitialProductionDb.Designer.cs\n        |       20210129104438_SeedInitData.cs\n        |       20210129104438_SeedInitData.Designer.cs\n        |       MainDbContextModelSnapshot.cs\n        |\n        \\---Scripts\n                20210129104438_SeedInitData.sql\n```\n# üéá Starting the APIs\n\n```\n$ cd samples\n$ tye run\n```\n\n- Public Apis:\n\n> Tye Dashboard: [http://localhost:8000](http://localhost:8000)\n>\n> Play around at [restclient.http](samples/restclient.http)\n\n<table>\n  <thead>\n    <th>No.</th>\n    <th>Service name</th>\n    <th>Service uri</th>\n  </thead>\n  <tbody>\n    <tr>\n      <td>1</td>\n      <td>YARP Gateway (downstream)</td>\n      <td><a href=\"http://localhost:5000\">http://localhost:5000</a></td>\n    </tr>\n    <tr>\n      <td>2</td>\n      <td>identity server</td>\n      <td><a href=\"https://localhost:5001\">https://localhost:5001</a></td>\n    </tr>\n    <tr>\n      <td>3</td>\n      <td>Web Blazor</td>\n      <td><a href=\"https://localhost:5002\">https://localhost:5002</a></td>\n    </tr>\n    <tr>\n      <td>4</td>\n      <td>product (upstream service)</td>\n      <td><a href=\"http://localhost:5003\">http://localhost:5003</a></td>\n    </tr>\n    <tr>\n      <td>5</td>\n      <td>customer (upstream service)</td>\n      <td><a href=\"http://localhost:5004\">http://localhost:5004</a></td>\n    </tr>\n    <tr>\n      <td>6</td>\n      <td>setting (upstream service)</td>\n      <td><a href=\"http://localhost:5005\">http://localhost:5005</a></td>\n    </tr>\n    <tr>\n      <td colspan=\"3\">\n        <img src=\"assets/highlevel_components.png\">\n      </td>\n    </tr>\n  </tbody>\n</table>\n\n# üéá Additional parts\n## Public CRUD interface\n\nIn medium and large software projects, we normally implement the CRUD actions over and over again. And it might take around 40-50% codebase just to do CRUD in the projects. The question is can we make standardized CRUD APIs, then we can use them in potential projects in the future? That is in my mind for a long time when I started and finished many projects, and I decide to take time to research and define the public interfaces for it as below\n\n### ‚úîÔ∏è Common\n\n```csharp\npublic record ResultModel<T>(T Data, bool IsError = false, string? ErrorMessage = default);\n```\n\n```csharp\npublic interface ICommand<T> : IRequest<ResultModel<T>> {}\n```\n\n```csharp\npublic interface IQuery<T> : IRequest<ResultModel<T>> {}\n```\n\n### ‚úîÔ∏è [R]etrieve\n\n```csharp\n// input model for list query (normally using for the table UI control with paging, filtering and sorting)\npublic interface IListQuery<TResponse> : IQuery<TResponse>\n{\n  public List<string> Includes { get; init; }\n  public List<FilterModel> Filters { get; init; }\n  public List<string> Sorts { get; init; }\n  public int Page { get; init; }\n  public int PageSize { get; init; }\n}\n```\n\n```csharp\n// output model with items, total items, page and page size with serving for binding with the table UI control\npublic record ListResponseModel<T>(List<T> Items, long TotalItems, int Page, int PageSize);\n```\n\n```csharp\npublic interface IItemQuery<TId, TResponse> : IQuery<TResponse>\n{\n  public List<string> Includes { get; init; }\n  public TId Id { get; init; }\n}\n```\n\n### ‚úîÔ∏è [C]reate\n\n```csharp\npublic interface ICreateCommand<TRequest, TResponse> : ICommand<TResponse>, ITxRequest\n{\n    public TRequest Model { get; init; }\n}\n```\n\n### ‚úîÔ∏è [U]pdate\n\n```csharp\npublic interface IUpdateCommand<TRequest, TResponse> : ICommand<TResponse>, ITxRequest\n{\n  public TRequest Model { get; init; }\n}\n```\n\n### ‚úîÔ∏è [D]elete\n\n```csharp\npublic interface IDeleteCommand<TId, TResponse> : ICommand<TResponse> where TId : struct\n{\n  public TId Id { get; init; }\n}\n```\n\n## Dapr components\n### ‚úîÔ∏è Service Invocation\n\n- RestEase with Dapr handler. More information is at https://dev.to/thangchung/how-to-make-dapr-client-works-well-with-refit-and-restease-40m\n\n### ‚úîÔ∏è Event Bus\n\n```csharp\npublic interface IEventBus\n{\n  Task PublishAsync<TEvent>(TEvent @event, string[] topics = default, CancellationToken token = default) where TEvent : IDomainEvent;\n\n  Task SubscribeAsync<TEvent>(string[] topics = default, CancellationToken token = default) where TEvent : IDomainEvent;\n}\n```\n\n- Dapr provider\n\n### ‚úîÔ∏è Transactional Outbox\n\n```csharp\npublic class OutboxEntity\n{\n    [JsonInclude]\n    public Guid Id { get; private set; }\n\n    [JsonInclude]\n    public DateTime OccurredOn { get; private set; }\n\n    [JsonInclude]\n    public string Type { get; private set; }\n\n    [JsonInclude]\n    public string Data { get; private set; }\n\n    public OutboxEntity()\n    {\n        // only for System.Text.Json to deserialized data\n    }\n\n    public OutboxEntity(Guid id, DateTime occurredOn, IDomainEvent @event)\n    {\n        Id = id.Equals(Guid.Empty) ? Guid.NewGuid() : id;\n        OccurredOn = occurredOn;\n        Type = @event.GetType().FullName;\n        Data = JsonConvert.SerializeObject(@event);\n    }\n\n    public virtual IDomainEvent RecreateMessage(Assembly assembly) => (IDomainEvent)JsonConvert.DeserializeObject(Data, assembly.GetType(Type)!);\n}\n```\n\n- Dapr provider\n\n## Sample pages\n\n![](assets/products_blazor_screen.png)\n\n# üéá Credits\n\n- https://docs.microsoft.com/en-us/dotnet/architecture/modern-web-apps-azure/common-web-application-architectures\n- https://github.com/zkavtaskin/Domain-Driven-Design-Example\n- https://github.com/ardalis/CleanArchitecture\n- https://github.com/CanerPatir/aspnet-core-clean-arch\n- https://github.com/jasontaylordev/CleanArchitecture\n- https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example\n- https://github.com/alibaba/COLA\n- [Ant Design Components](https://ant.design/components/overview)\n- [C4 PlaintUML Model](https://github.com/plantuml-stdlib/C4-PlantUML/blob/master/samples/C4CoreDiagrams.md)\n- [Real world PlantUML](https://real-world-plantuml.com)\n",
  "stars": 1310,
  "timestamp": "2025-06-27T00:14:23.169098",
  "category": "advanced_patterns"
}