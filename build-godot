#!/usr/bin/env python3
"""
WSLÏóêÏÑú AI Godot ÎπåÎìú Ïã§Ìñâ - ÌÜµÌï© Î™ÖÎ†πÏñ¥
"""
import os
import subprocess
import sys
from pathlib import Path

# ÏÉâÏÉÅ ÏΩîÎìú
GREEN = '\033[92m'
YELLOW = '\033[93m'
RED = '\033[91m'
BLUE = '\033[94m'
CYAN = '\033[96m'
RESET = '\033[0m'

def main():
    print(f"\n{BLUE}ü§ñ AutoCI - AI Godot ÎπåÎìú ÏãúÏä§ÌÖú{RESET}")
    print("=" * 50)
    
    # Ïä§ÌÅ¨Î¶ΩÌä∏ ÏúÑÏπò Ï∞æÍ∏∞
    if Path(__file__).is_symlink():
        script_path = Path(os.readlink(__file__))
    else:
        script_path = Path(__file__).resolve()
    
    project_dir = script_path.parent
    
    # ÏòµÏÖò ÌëúÏãú
    print(f"\n{YELLOW}ÎπåÎìú ÏòµÏÖò:{RESET}")
    print(f"1. {GREEN}AI ÏàòÏ†ïÎêú Godot ÎπåÎìú (Linux){RESET} - WSLÏóêÏÑú ÏßÅÏ†ë ÎπåÎìú ‚≠ê")
    print(f"2. {CYAN}Îπ†Î•∏ Windows ÏÑ§Ï†ï (5Î∂Ñ){RESET} - ÏùºÎ∞ò Godot Îã§Ïö¥Î°úÎìú")
    print(f"3. {YELLOW}Ï†ÑÏ≤¥ Windows ÎπåÎìú (1ÏãúÍ∞Ñ){RESET} - WindowsÏóêÏÑú ÏÜåÏä§ ÎπåÎìú")
    print("4. Ï∑®ÏÜå")
    
    choice = input(f"\n{GREEN}ÏÑ†ÌÉù (1-4) [Í∏∞Î≥∏: 1]: {RESET}").strip()
    
    if choice == "4":
        print("Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.")
        return 0
    
    # Í∏∞Î≥∏Í∞íÏùÄ 1 (AI ÏàòÏ†ïÎêú Linux ÎπåÎìú)
    if not choice or choice == "1":
        print(f"\n{GREEN}üî® AI ÏàòÏ†ïÎêú Godot ÎπåÎìúÎ•º ÏãúÏûëÌï©ÎãàÎã§...{RESET}")
        print("ÏòàÏÉÅ ÏãúÍ∞Ñ: 20-60Î∂Ñ")
        print("")
        
        # build_ai_godot.py Ïã§Ìñâ
        build_script = project_dir / "build_ai_godot.py"
        if not build_script.exists():
            print(f"{RED}‚ùå build_ai_godot.pyÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.{RESET}")
            return 1
        
        try:
            # PythonÏúºÎ°ú ÏßÅÏ†ë Ïã§Ìñâ
            result = subprocess.run([sys.executable, str(build_script)], 
                                  cwd=str(project_dir))
            
            if result.returncode == 0:
                print(f"\n{GREEN}‚úÖ ÎπåÎìú ÏÑ±Í≥µ!{RESET}")
                print(f"\nÎã§Ïùå Îã®Í≥Ñ:")
                print(f"1. {GREEN}autoci{RESET} Î™ÖÎ†πÏñ¥ Ïã§Ìñâ")
                print(f"2. AI GodotÏù¥ ÏûêÎèôÏúºÎ°ú Ïã§ÌñâÎê©ÎãàÎã§")
            else:
                print(f"\n{RED}‚ùå ÎπåÎìú Ïã§Ìå®{RESET}")
                print("godot_ai_build/logs/ Ìè¥ÎçîÏùò Î°úÍ∑∏Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.")
            
            return result.returncode
            
        except Exception as e:
            print(f"{RED}‚ùå Ïã§Ìñâ Ï§ë Ïò§Î•ò: {e}{RESET}")
            return 1
            
    elif choice == "2":
        bat_file = project_dir / "RUN_SIMPLE_BUILD.bat"
        print(f"\n{CYAN}Îπ†Î•∏ Windows ÏÑ§Ï†ïÏùÑ ÏãúÏûëÌï©ÎãàÎã§...{RESET}")
    elif choice == "3":
        bat_file = project_dir / "BUILD_AI_GODOT.bat"
        print(f"\n{YELLOW}Ï†ÑÏ≤¥ Windows ÎπåÎìúÎ•º ÏãúÏûëÌï©ÎãàÎã§...{RESET}")
    else:
        print(f"{RED}ÏûòÎ™ªÎêú ÏÑ†ÌÉùÏûÖÎãàÎã§.{RESET}")
        return 1
    
    # Windows Í≤ΩÎ°úÎ°ú Î≥ÄÌôò
    wsl_path = str(bat_file.absolute())
    
    if wsl_path.startswith('/mnt/'):
        drive = wsl_path[5]
        win_path = f"{drive.upper()}:{wsl_path[6:].replace('/', '\\')}"
    else:
        result = subprocess.run(['wslpath', '-w', wsl_path], 
                              capture_output=True, text=True)
        if result.returncode == 0:
            win_path = result.stdout.strip()
        else:
            print(f"{RED}‚ùå Windows Í≤ΩÎ°ú Î≥ÄÌôò Ïã§Ìå®{RESET}")
            return 1
    
    # Ïã§Ìñâ
    print(f"\n{BLUE}WindowsÏóêÏÑú Ïã§Ìñâ Ï§ë...{RESET}")
    print(f"Í≤ΩÎ°ú: {win_path}")
    
    try:
        # ÏÉà Ï∞ΩÏóêÏÑú Ïã§Ìñâ
        subprocess.run(['cmd.exe', '/c', 'start', win_path])
        
        print(f"\n{GREEN}‚úÖ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ïã§ÌñâÎêòÏóàÏäµÎãàÎã§!{RESET}")
        print("\nÎã§Ïùå Îã®Í≥Ñ:")
        print(f"1. Windows Ï∞ΩÏóêÏÑú ÏÑ§Ï†ïÏù¥ {YELLOW}ÏôÑÎ£åÎê† ÎïåÍπåÏßÄ Í∏∞Îã§Î¶¨ÏÑ∏Ïöî{RESET}")
        print(f"2. ÏôÑÎ£åÎêòÎ©¥ Ïù¥ ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú {GREEN}autoci{RESET} Ïã§Ìñâ")
        print("\nÏòàÏãú:")
        print(f"  {GREEN}$ autoci{RESET}")
        print(f"  {GREEN}> create platformer game{RESET}")
        
    except Exception as e:
        print(f"{RED}‚ùå Ïã§Ìñâ Ï§ë Ïò§Î•ò: {e}{RESET}")
        return 1
    
    return 0

if __name__ == "__main__":
    sys.exit(main())