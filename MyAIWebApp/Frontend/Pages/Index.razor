@page "/"
@inject HttpClient Http

<h1>AI 웹 애플리케이션</h1>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2>텍스트 생성</h2>
            <textarea @bind="prompt" class="form-control" rows="3"></textarea>
            <button @onclick="GenerateText" class="btn btn-primary mt-2">생성</button>
            
            @if (!string.IsNullOrEmpty(generatedText))
            {
                <div class="alert alert-success mt-3">
                    @generatedText
                </div>
            }
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-md-12">
            <h2>RAG 질문하기</h2>
            <input @bind="question" class="form-control" />
            <button @onclick="AskQuestion" class="btn btn-primary mt-2">질문</button>
            
            @if (!string.IsNullOrEmpty(answer))
            {
                <div class="alert alert-info mt-3">
                    @answer
                </div>
            }
        </div>
    </div>
</div>

@code {
    private string prompt = "";
    private string generatedText = "";
    private string question = "";
    private string answer = "";
    
    private async Task GenerateText()
    {
        var response = await Http.PostAsJsonAsync("api/ai/generate", 
            new { prompt });
        
        if (response.IsSuccessStatusCode)
        {
            var result = await response.Content.ReadFromJsonAsync<GenerateResponse>();
            generatedText = result?.Result ?? "";
        }
    }
    
    private async Task AskQuestion()
    {
        var response = await Http.PostAsJsonAsync("api/ai/rag/query", 
            new { question });
        
        if (response.IsSuccessStatusCode)
        {
            var result = await response.Content.ReadFromJsonAsync<RAGResponse>();
            answer = result?.Answer ?? "";
        }
    }
    
    public class GenerateResponse
    {
        public string Result { get; set; } = "";
    }
    
    public class RAGResponse
    {
        public string Answer { get; set; } = "";
    }
}